{% extends 'base.html.twig' %}

{% block title %}Correction{% endblock %}

{% block javascripts %}
    <script>
        function toggleAccordion(id) {
            let accordion = document.getElementById(id);
            let chevron = document.getElementById('chevron' + id.replace('accordion', ''));

            // Vérifie si l'accordéon a la classe 'disabled-accordion'
            if (!accordion.classList.contains('disabled-accordion')) {
                if (accordion.style.maxHeight) {
                    accordion.style.maxHeight = null;
                    chevron.classList.remove('rotate-180');
                } else {
                    accordion.style.maxHeight = accordion.scrollHeight + "px";
                    chevron.classList.add('rotate-180');
                }
            }
        }
    </script>
{% endblock %}


{% block body %}
<div class="mt-8 sm:mx-auto sm:w-full">
    <div class="bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10">
        <h3 class="text-lg leading-6 font-medium text-gray-900">Titre: {{ title }}</h3>
        <h3 class="mt-2 text-sm text-gray-600">Description: {{ description }}</h3>
        <div class="mt-6 grid grid-cols-1 sm:grid-cols-1 lg:grid-cols-1 gap-4">
            {% for question in questions %}
                <div class="p-5 bg-white rounded-lg shadow-lg">
                    <!-- Zone cliquable pour déplier l'accordéon -->
                    <div onclick="toggleAccordion('accordion{{ question.question.id }}')" class="flex justify-between items-center cursor-pointer">
                        <div class="flex items-center">
                            <h4 class="text-lg font-semibold text-gray-800">Question: {{ question.question.questionText }} <small class="font-normal text-gray-700">({{ question.question.point }} point)</small></h4>
                        </div>
                        <button class="focus:outline-none">
                            <svg class="w-6 h-6 transform transition-transform" id="chevron{{ question.question.id }}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                    </div>
                    <!-- Contenu de l'accordéon -->
                    <div id="accordion{{ question.question.id }}" class="max-h-0 overflow-hidden transition-max-height duration-700 ease-in-out ">
                    <form action="{{ path('submit_student_response', {'id': question.question.id}) }}" method="post" class="mt-2" onsubmit="return submitForm(this);">
                            <ul class="list-none">
                                {% if question.question.type.name == 'QCM' %}
                                    {% for reponse in question.questionReponses %}
                                        <li class="mb-1">
                                        <label class="inline-flex items-center">
                                            <input type="checkbox" class="h-5 w-5 text-red-600" id="response_student_{{ question.question.id }}" name="response_student_{{ question.question.id }}" value="{{ reponse.text | e('html_attr') }}" {% if question.question.studentReponse != null and reponse.text in question.question.studentReponse %}checked{% endif %}>
                                            <span class="ml-2 text-gray-700">{{ reponse.text }}</span>
                                        </label>
                                        </li>
                                    {% endfor %}
                                {% elseif question.question.type.name == 'UNIQUE_CHOICE' %}
                                    {% for reponse in question.questionReponses %}
                                        <li class="mb-1">
                                            <label class="inline-flex items-center">
                                                <input type="radio" class="h-5 w-5 text-red-600" id="response_student_{{ reponse.id }}" name="response_student_{{ question.question.id }}" value="{{ reponse.text | e('html_attr') }}" {% if question.question.studentReponse != null and reponse.text in question.question.studentReponse %}checked{% endif %}>
                                                <span class="ml-2 text-gray-700">{{ reponse.text }}</span>
                                            </label>
                                        </li>
                                    {% endfor %}
                                {% elseif question.question.type.name == 'OPEN_QUESTION' %}
                                    <li class="mb-1">
                                        <label for="open_response_{{ question.question.id }}" class="block text-gray-700">Réponse:</label>
                                        <textarea id="open_response_{{ question.question.id }}" name="response_student_{{ question.question.id }}" rows="3" class="mt-1 block border w-full rounded-md border-gray-300 shadow-sm focus:border-red-300 focus:ring focus:ring-red-200 focus:ring-opacity-50">{{ studentReponse.value }}</textarea>
                                    </li>
                                {% endif %}
                            </ul>
                            <div class="flex justify-end mt-2">
                                <input type="hidden" name="questionType" value="{{ question.question.type.name }}">
                                <input type="hidden" name="testId" value="{{ id }}">
                                <button class="bg-green-500 hover:bg-green-700 text-white font-bold py-1 px-2 rounded">
                                    Envoyer
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</div>


{% endblock %}
