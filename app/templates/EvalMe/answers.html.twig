{% extends 'base.html.twig' %}

{% block title %}Test{% endblock %}

{% block javascripts %}
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Script pour gérer l'ouverture et la fermeture de la modale
            const modal = document.getElementById('myModal');
            const btn = document.getElementById('openModalBtn');
            const span = document.getElementsByClassName('closeBtn')[0];

            const editModal = document.getElementById('editModal'); // Assurez-vous que l'ID correspond à votre modale d'édition
            const editSpan = document.getElementsByClassName('editCloseBtn')[0]; // Utilisez une classe unique pour le bouton de fermeture de la modale d'édition

            if (editSpan) {
                editSpan.onclick = function() {
                    editModal.style.display = 'none';
                }
            }

            if (btn) {
                btn.onclick = function() {
                    modal.style.display = 'block';
                }
            }

            if (span) {
                span.onclick = function() {
                    modal.style.display = 'none';
                }
            }

            window.onclick = function(event) {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            }

            // Gestion des champs conditionnels basés sur le type de question
            const questionTypeSelect = document.getElementById('questionType');
            const conditionalFieldsContainer = document.getElementById('conditionalFields');

            if (questionTypeSelect) {
                const updateConditionalFields = () => {
                    const type = questionTypeSelect.value;
                    let fieldsHtml = '';

                    switch (type) {
                        case 'qcm':
                            fieldsHtml = `
                    <label>Choix (cochez toutes les réponses correctes) :</label>
                    <div class="flex items-center mb-2 p-2"><input type="checkbox" name="answers1" value="A" class="mr-2"> A <input type="text" name="responseA" class="ml-2 rounded border-gray-300 p-2 border" placeholder="Réponse A"></div>
                    <div class="flex items-center mb-2 p-2"><input type="checkbox" name="answers2" value="B" class="mr-2"> B <input type="text" name="responseB" class="ml-2 rounded border-gray-300 p-2 border" placeholder="Réponse B"></div>
                    <div class="flex items-center mb-2 p-2"><input type="checkbox" name="answers3" value="C" class="mr-2"> C <input type="text" name="responseC" class="ml-2 rounded border-gray-300 p-2 border" placeholder="Réponse C"></div>
                    <div class="flex items-center mb-2 p-2"><input type="checkbox" name="answers4" value="D" class="mr-2"> D <input type="text" name="responseD" class="ml-2 rounded border-gray-300 p-2 border" placeholder="Réponse D"></div>
                    `;
                            break;
                        case 'unique_choice':
                            fieldsHtml = `
                    <label>Choisissez la bonne réponse :</label>
                    <div class="flex items-center mb-2 p-2"><input type="radio" name="answer1" value="A" class="mr-2"> A <input type="text" name="responseA" class="ml-2 rounded border-gray-300 p-2 border" placeholder="Réponse A"></div>
                    <div class="flex items-center mb-2 p-2"><input type="radio" name="answer2" value="B" class="mr-2"> B <input type="text" name="responseB" class="ml-2 rounded border-gray-300 p-2 border" placeholder="Réponse B"></div>
                    <div class="flex items-center mb-2 p-2"><input type="radio" name="answer3" value="C" class="mr-2"> C <input type="text" name="responseC" class="ml-2 rounded border-gray-300 p-2 border" placeholder="Réponse C"></div>
                    <div class="flex items-center mb-2 p-2"><input type="radio" name="answer4" value="D" class="mr-2"> D <input type="text" name="responseD" class="ml-2 rounded border-gray-300 p-2 border" placeholder="Réponse D"></div>
                    `;
                            break;
                        case 'null':
                            fieldsHtml = `
                    <label for="openAnswer">Réponse :</label>
                    <textarea id="openAnswer" name="openAnswer" class="p-2 mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50"></textarea>
                    `;
                            break;
                    }

                    conditionalFieldsContainer.innerHTML = fieldsHtml;
                };

                questionTypeSelect.addEventListener('change', updateConditionalFields);
                // Appel initial pour configurer les champs conditionnels au chargement de la page
                updateConditionalFields();
            }
        });

        function openEditModal(questionId, questionText, questionPoint, questionType, baseUrl) {
            // Remplir les champs du formulaire dans la modale
            document.getElementById('edit_questionId').value = questionId;
            document.getElementById('edit_questionText').value = questionText;
            document.getElementById('edit_questionPoint').value = questionPoint;
            document.getElementById('edit_questionType').value = questionType;

            // Mettre à jour le formulaire et les champs conditionnels
            changeQuestionType(questionType);

            // Construire l'URL complète pour l'action du formulaire
            let editUrl = baseUrl.replace(':id', questionId);
            document.getElementById('editForm').action = editUrl;

            // Afficher la modale
            document.getElementById('editModal').style.display = 'block';
        }

        function changeQuestionType(questionType) {
            let selectedType = questionType;
            let conditionalFields = document.getElementById('edit_conditionalFields');

            // Effacez les champs conditionnels existants
            conditionalFields.innerHTML = '';

            // Générer les champs en fonction du type de question sélectionné
            if (selectedType === 'QCM' || selectedType === 'UNIQUE_CHOICE') {
                // Ajoutez vos inputs pour les réponses (exemple simple)
                for (let i = 1; i <= 4; i++) { // Générer 4 réponses pour l'exemple
                    conditionalFields.innerHTML += `<label class="block text-gray-700">Réponse ${i}: <input type="text" name="response_${i}" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></label>`;
                    if (selectedType === 'qcm') {
                        conditionalFields.innerHTML += `<input type="checkbox" name="correct_${i}"> Correct<br/>`;
                    } else {
                        conditionalFields.innerHTML += `<input type="radio" name="correct" value="${i}"> Correct<br/>`;
                    }
                }
            } else if (selectedType === 'OPEN_QUESTION') {
                // Ajoutez votre textarea pour une question ouverte
                conditionalFields.innerHTML += '<label class="block text-gray-700">Réponse: <textarea name="open_response" rows="4" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm"></textarea></label>';
            }
        }
    </script>
{% endblock %}


{% block body %}
    <div class="bg-gray-100">
        <div class="mt-8 sm:mx-auto sm:w-full">
            <div class="bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10">
                <h3 class="text-lg leading-6 font-medium text-gray-900">Titre: {{ title }}</h3>
                <h3 class="mt-2 text-sm text-gray-600">Description: {{ description }}</h3>
            </div>
        </div>
        <div class="container mx-auto mt-8">
            <h1 class="text-xl font-semibold text-gray-800">Liste des Élèves</h1>
            <div class="mt-6">
                <table class="min-w-full table-auto">
                    <thead class="bg-gray-200">
                        <tr>
                            <th></th>
                            <th class="px-4 py-2 text-left text-gray-600">Nom</th>
                            <th class="px-4 py-2 text-left text-gray-600">Prénom</th>
                            <th class="px-4 py-2 text-left text-gray-600">Nombre de réponses</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white">
                        {% for student in students %}
                            <tr class="border-b">
                                <td class="px-4 py-2 text-center">
                                    <img src="{{ student.picture }}" alt="Photo de profil" class="h-10 w-10 rounded-full object-cover mx-auto">
                                </td>
                                <td class="px-4 py-2 text-gray-700">{{ student.nom }}</td>
                                <td class="px-4 py-2 text-gray-700">{{ student.prenom }}</td>
                                <td class="px-4 py-2 text-gray-700">{{ student.reponses}}/{{questions|length}}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    <div>


{% endblock %}
